# E-Commerce SQL Challenges

This repository documents my solutions to a simulated e-commerce SQL assessment. The dataset represents a hypothetical e-commerce business with **Customers**, **Products**, and **Orders** tables. The challenges progress from easy to advanced and test a wide range of SQL skills.

---

## ðŸ“‚ **Dataset Overview**

### **Tables**
1. **Customers**: Contains customer details such as name, email, and sign-up date.
2. **Products**: Lists products with details like price and category.
3. **Orders**: Tracks customer purchases with order dates, quantities, and product IDs.

---

## ðŸ“ **Challenges and Solutions**

### **1: Customers Who Signed Up in 2022**
**Question**: Find the names and email addresses of all customers who signed up in 2022.

```sql
SELECT 
    FirstName, 
    LastName, 
    Email
FROM ecomm.Customers
WHERE SignupDate >= '2022-01-01' AND SignupDate < '2023-01-01';
```

### **2: Total Revenue in February 2023**
**Question:** Find the total revenue generated from all orders placed in February 2023.

**Expected Output:** A single column showing the total revenue for February 2023.

***Sometimes I like to take a quick peek at my data at a record level before calculating any metrics. So time and again I'll include a "base query" if I feel the need to see our intermediate records.***  

```sql
-- Base Query
select  o.OrderID
        ,o.OrderDate
        ,o.ProductID
        ,o.Quantity
        ,p.ProductName
        ,p.Price
        ,o.Quantity*p.Price as Sale
from ecomm.Orders o left join ecomm.Products p on o.ProductID = p.ProductID
where 1=1
and o.OrderDate >= '2023-02-01' and o.OrderDate < '2023-03-01';
```

```sql
-- Final Query
select  sum(o.Quantity*p.Price) as total_Revenue
from ecomm.Orders o left join ecomm.Products p on o.ProductID = p.ProductID
where 1=1
and o.OrderDate >= '2023-02-01' and o.OrderDate < '2023-03-01';
```

### **3: Average Order Value (AOV) per Customer**

**Question:** Calculate the Average Order Value (AOV) for each customer for all orders placed in 2023. The AOV is calculated by dividing the total revenue generated by a customer by the number of orders they made in 2023.

**Expected Output:**
	â€¢	CustomerID
	â€¢	Total Revenue (sum of all order values for that customer in 2023)
	â€¢	Number of Orders (count of orders placed by that customer in 2023)
	â€¢	Average Order Value (AOV) (calculated as Total Revenue divided by Number of Orders)

**Notes:** Ensure the calculation is done for each customer, not for all customers as a whole.

Here again we use a base query.

```sql
-- BASE QUERY
select  o.OrderID
        ,o.OrderDate
        ,c.CustomerID
        ,c.FirstName
        ,c.LastName
        ,p.ProductName
        ,o.Quantity        
        ,p.Price
        ,o.Quantity*p.Price as Sale
from ecomm.Orders o left join ecomm.Products p on o.ProductID = p.ProductID
left join ecomm.Customers c on o.CustomerID = c.CustomerID
where 1=1 
and o.OrderDate >= '2023-01-01' and o.OrderDate < '2024-01-01'
-- and CustomerID = 1 -- quick validation for a customer
order by o.CustomerID;
```

```sql
with aov as 
(-- BASE QUERY
select  o.OrderID
        ,o.OrderDate
        ,c.CustomerID
        ,c.FirstName
        ,c.LastName
        ,p.ProductName
        ,o.Quantity        
        ,p.Price
        ,o.Quantity*p.Price as Sale
from ecomm.Orders o left join ecomm.Products p on o.ProductID = p.ProductID
left join ecomm.Customers c on o.CustomerID = c.CustomerID
and o.OrderDate >= '2023-01-01' and o.OrderDate < '2024-01-01' -- for orders made in 2023
)

select  CustomerID
        ,FirstName || ' ' || LastName
        ,count(orderid) as total_Orders
        ,sum(sale) as total_Sale
        ,cast(sum(sale)/count(orderid) as decimal(10,2)) as avgOrderValue
from aov
group by CustomerID,FirstName,LastName;
```

### **4: Average Order Value (AOV) per Customer**
**Question:** We want to calculate the running total of sales for each customer in 2023.
For each customer, we want to display the running total of their sales as they placed orders throughout the year.

**Expected Output:** Return the CustomerID,OrderDate,Sale Amount, and Running Total (the cumulative sum of sales for that customer, ordered by OrderDate)

**Notes:** Ensure the calculation is done for each customer, not for all customers as a whole.

Here again we use a base query.

```sql
-- BASE QUERY
select  o.OrderID
        ,o.OrderDate
        ,c.CustomerID
        ,FirstName || ' ' || LastName
        ,p.ProductName
        ,o.Quantity        
        ,p.Price
        ,o.Quantity*p.Price as Sale
        ,sum(o.Quantity*p.Price) over(PARTITION BY c.CustomerID order by o.OrderDate) as r
from ecomm.Orders o left join ecomm.Products p on o.ProductID = p.ProductID
left join ecomm.Customers c on o.CustomerID = c.CustomerID
where 1=1 
and o.OrderDate >= '2023-01-01' and o.OrderDate < '2024-01-01' -- for orders made in 2023
-- and CustomerID = 1 -- spot check 
order by o.CustomerID,o.OrderDate;
```

```sql
-- FINAL QUERY

with cte as 
(-- BASE QUERY
select  o.OrderID
        ,o.OrderDate
        ,c.CustomerID        
        ,FirstName || ' ' || LastName as name
        ,p.ProductName
        ,o.Quantity        
        ,p.Price
        ,o.Quantity*p.Price as Sale
from ecomm.Orders o left join ecomm.Products p on o.ProductID = p.ProductID
left join ecomm.Customers c on o.CustomerID = c.CustomerID
where 1=1 
and o.OrderDate >= '2023-01-01' and o.OrderDate < '2024-01-01' -- for orders made in 2023
-- and CustomerID = 1 -- spot check 
)

select  CustomerID
        ,OrderDate
        -- ,name
        ,sum(Sale) over(PARTITION BY CustomerID order by OrderDate) as r
from cte;
```


### **5: Analyze customer retention for the business**
**Question:** We want to analyze customer retention for the business. Your task is to identify repeat customers who have placed more than one order in 2023.

**Expected Output:** Return the CustomerID,CustomerName (First and Last Name combined), and TotalOrders (Number of orders placed by the customer in 2023)

**Notes:** Include only customers with more than one order in 2023. The results should be sorted by TotalOrders in descending order.
```sql
select  c.CustomerID        
        ,FirstName || ' ' || LastName as name
        ,count(o.OrderID) as total_orders
from ecomm.Orders o left join ecomm.Customers c on o.CustomerID = c.CustomerID
where 1=1 
and o.OrderDate >= '2023-01-01' and o.OrderDate < '2024-01-01' -- for orders made in 2023
group by c.CustomerID,FirstName || ' ' || LastName
order by total_orders desc;
```


### **6: Top-performing products by revenue**
**Question:** Find the top 5 products by total revenue in 2023. For each of these products, return the ProductName, TotalRevenue (Sum of sales for that product in 2023), PercentageContribution (The percentage of the productâ€™s revenue compared to the total revenue across all products in 2023).

**Expected Output:** Return the CustomerID,CustomerName (First and Last Name combined), and TotalOrders (Number of orders placed by the customer in 2023)

**Notes:** Calculate the total revenue across all products. Order by TotalRevenue in descending order to get the top 5. Calculate PercentageContribution as (Product Revenue / Total Revenue) * 100.

```sql
-- BASE QUERY
select  p.ProductName
        ,sum(o.Quantity*p.Price) as Sale
from ecomm.Orders o left join ecomm.Products p on o.ProductID = p.ProductID
where 1=1
and o.OrderDate >= '2023-01-01' and o.OrderDate < '2024-01-01' -- for orders made in 2023
group by p.ProductName
order by Sale desc;
```

```sql
with cte as 
(-- BASE QUERY
    select  p.ProductName
            ,sum(o.Quantity*p.Price) as Sale
    from ecomm.Orders o left join ecomm.Products p on o.ProductID = p.ProductID
    where 1=1
    and o.OrderDate >= '2023-01-01' and o.OrderDate < '2024-01-01' -- for orders made in 2023
    group by p.ProductName
    order by Sale desc 
)
select ProductName
        ,sale as TotalRevenue
        ,cast(cast(100.0*sale/(select sum(sale) from cte) as decimal(10,2)) as varchar) || '%' as PercentageContribution
from cte 
order by TotalRevenue desc
limit 5;
```




